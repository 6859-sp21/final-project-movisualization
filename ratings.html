<html>

<head>
  <!-- Load d3.js -->
  <link rel="stylesheet" href="web.css">
  <script src="https://d3js.org/d3.v6.js"></script>
</head>

<body>
  <div class="ratings-container">
    <div class="ratings-subcontainer">
      <h2>Overall Ratings</h2>
      <p style="width: 700px">Overall ratings from IMDB of movie.</p>

      <div class="loader" id="loader1" style="margin-top: 120;"></div>

      <div id="chart" style="width:420px;height:420px;"></div>
    </div>
    <div class = "ratings-subcontainer-2">
       <div class = "ratings-sub-subcontainer-1">
        <h2>Rating Breakdown</h2>
        <p style="width: 700px">
            Breakdown of rating of user votes per rating value.
        </p>
        <div class="loader" id="loader2" style="margin-top: 120;"></div>
        <div id="chart2" style="width:420px;height:420px; float:left"></div>
      </div>
      <div class = "ratings-sub-subcontainer-2">
        <h2>Compare your rating</h2>
        <p style="width: 700px">Ratings by demographics compared to your rating</p>
        <div id="chart3" style="width:420px;height:420px; float:left"></div>
      </div>
    </div>
  </div>
  <style>
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>

  <script>
    function doneLoading() {
      document.getElementById("loader1").style.display = "none";
      document.getElementById("loader2").style.display = "none";
    };

d3.csv("data_cleaned_merged/movie_title_metadata.csv").then((movie_data) => {
    // GRAPH SET UP 
    // GRAPH: OVERALL RATINGS
    const height = 400;
    const width = 500;
    const margin = ({ top: 10, right: 10, bottom: 50, left: 60 });
    var color = d3.scaleOrdinal()
    .domain(['m', 'f'])
    .range(['#f5d6b0', '#619ba5'])

    // 3. Create a SVG we will use to make our chart.
    const svg = d3.create('svg')
    .attr('width', width)
    .attr('height', height);

    // 4. Setting up scales.
    const xScale = d3.scaleBand()
    .domain([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
    .range([margin.left, width - margin.right])
    .padding([0.2])

    const yScale = d3.scaleLinear()
    .domain([0, 40])
    .range([height - margin.bottom, margin.top])
    .nice();

    svg.append('g')
    .attr('transform', "translate(" + margin.left + "," + margin.top + ")")

    //6. Drawing our x-axis
    svg.append('g')
    .attr('transform', `translate(0, ${height - margin.bottom})`)
    .call(d3.axisBottom(xScale).tickSize(0))

    // //7. Drawing our y-axis
    svg.append('g')
    .attr('transform', `translate(${margin.left}, 0)`)
    .call(d3.axisLeft(yScale).tickFormat(d => d + "%"))

    //   svg.append("text")
    //     .attr("transform",
    //       "translate(" + (width / 2) + " ," +
    //       (height + margin.top - 20) + ")")
    //     .style("text-anchor", "middle")
    //     .text("Position in Credits");

    svg.append("g")
    .selectAll("g")
    .data(data_line)
    .enter()
    .append("g")
    .attr("transform", function (d) { return "translate(" + xScale(d.position) + ",0)"; })
    .selectAll("rect")
    .data(function (d) {
        a = [{ key: 'm', value: d.male_lines_avg }, { key: 'f', value: d.female_lines_avg }]
        return a
    })
    .enter().append("rect")
    .attr("x", function (d) { return xSubgroup(d.key); })
    .attr("y", function (d) { return yScale(d.value); })
    .attr("width", xSubgroup.bandwidth())
    .attr("height", function (d) { return height - margin.bottom - yScale(d.value); })
    .attr("fill", function (d) { return color(d.key); })
    .on("mouseover", function (event, d) {
        tooltip.transition()
        .duration(200)
        .style("opacity", .9)
        tooltip.html(function () {
        if (d.key === 'm') {
            return "Male lines: " + parseInt(d.value) + "%"
        } else {
            return "Female lines: " + parseInt(d.value) + "%"
        }
        })
        .style("left", (event.pageX) + "px")
        .style("top", (event.pageY - 28) + "px");
    })
    .on("mouseout", function (event, d) {
        tooltip.transition()
        .duration(500)
        .style("opacity", 0);
    })

    document.getElementById("chart").appendChild(svg.node());
    doneLoading();

    function updatePosition() {}
});

  </script>
</body>
</html>