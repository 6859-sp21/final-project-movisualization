<html>
  <head>
    <link rel="stylesheet" href="web.css">
    <script src="https://d3js.org/d3.v6.js"></script>
  </head>
  <body>
    <div id="chart" style="width:420px;height:420px;">
    </div>
    <style>
    div.tooltip {
        color: black;
        position: absolute;
        text-align: left;
        width: auto;
        height: auto;
        padding: 5px;
        font-family: Futura;
        font: 12px sans-serif ;
        background: #FCB8C3FF;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
        }
    </style>

    <script>
    d3.csv("data_cleaned_merged/line_percents_by_gender.csv").then((allData) => {
        allData.forEach(function(d){
            console.log(d)
            d.Movie = d.Title
            d.ID = d.Movie_ID.value.substring(1)
            d.F_Percent = d.Female_Percent
            d.M_Percent = d.Male_Percent;
        })
        var fMax = Math.max(20, d3.max(allData, function(d){return d.F_Percent}));
        var mMax = Math.max(20, d3.max(allData, function(d){return d.M_Percent}));

        const height = 400;
        const width = 500;;
        const margin = ({top: 10, right: 10, bottom: 20, left: 30});
        var color = d3.scaleOrdinal()
            .domain(['m','f'])
            .range(['#f5d6b0','#619ba5'])

        const svg = d3.create('svg')
            .attr('width', width)
            .attr('height', height);

        const xScale = d3.scaleBand()
          .domain([1,2,3,4,5,6,7,8,9,10])
          .range([margin.left, width - margin.right])
          .padding([0.2])
         // .nice();

         var xSubgroup = d3.scaleBand()
            .domain(['m', 'f'])
          .range([0, xScale.bandwidth()])
          .padding([0.05])

        const yScale = d3.scaleLinear()
          .domain([0, 100])
          .range([height - margin.bottom, margin.top])
          .nice();


        svg.append("g")
          .selectAll("g")
          .data(allData)
          .enter()
          .append("g")
          .attr("transform", function(d) { return "translate(" + xScale(d.M_Percent) + ",0)"; })
          .selectAll("rect")
          .data(function(d) {
            a = [{key: 'm', value: d.M_Percent}, {key:'f', value:d.F_Percent}]
             return a})
           .enter().append("rect")
            .attr("x", function(d) { return xSubgroup(d.key); })
            .attr("y", function(d) { return yScale(d.value); })
             .attr("width", xSubgroup.bandwidth())
            .attr("height", function(d) { return height - margin.bottom- yScale(d.value); })
            .attr("fill", function(d) { return color(d.key); })
            .on("mouseover", function(event, d){
                tooltip.transition()
                .duration(200)
                .style("opacity", .9)
                tooltip.html(function(){
                  if(d.key === 'm'){
                    return "Male lines: " + parseInt(d.value) +"%"
                  }else{
                    return "Female lines: " + parseInt(d.value)+"%"
                  }
                })
                  .style("left", (event.pageX) + "px")
                  .style("top", (event.pageY - 28) + "px");
             })
            .on("mouseout", function(event, d) {
                tooltip.transition()
                .duration(500)
                .style("opacity", 0);
            })
        document.getElementById("chart").appendChild(svg.node());
    });
    </script>
</body>
</html>